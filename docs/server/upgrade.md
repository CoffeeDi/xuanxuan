# 服务器端升级

如果你所使用的服务器端是官方版本，推荐你总是使用官方发布的最新版本（当前最新版本为 `${verison}`）。当官方发布了新版本时，可以参照此文档对后端服务器和 XXD 服务器进行升级。

?> 提示：升级服务器需要停止之前运行的版本，所以会造成服务中断，所有已连接的客户端都会断开。请尽量按照计划对服务器进行升级操作，以免影响用户正常使用。

!> 注意：所有升级操作之前都应该对之前的数据和文件进行备份，以防止出现不可挽回的损失。

## 升级后端服务器

根据你所使用的后端服务器类型的不同选择升级方法：

<!-- tabs:start -->

### ** 升级 xxb  **

根据 xxb 安装方式的不同有不同的升级方式：

#### 方式一：使用源码方式升级（通用）

下面是使用官方源码包来进行升级的步骤，此方式适合所有情况：

1. 首先访问 xxb **后台 → 系统 → 备份** 功能页面备份之前的数据和文件；
2. 下载 xxb 最新版本源码包 [xxb.${version}.zip](${downloadUrl}${version}/xxb.${version}.zip)；
3. 解压缩源码包，将解压后的所有文件合并到原来的 xxb 站点根目录，如果使用的是 Windows 一键安装包，则将源码文件合并到一键安装包的 `xampp/xxb` 目录内，如果使用的是 Linux 一键安装包，则只需要将源码文件合并到一键安装包的 `/opt/zbox/app` 目录内；
4. 访问 xxb 升级功能页面，例如 xxb 访问地址为 `http://192.168.0.100`，则升级功能页面地址为 `http://192.168.0.100/upgradexuanxuan.php`，按照页面提示进行升级操作，在此步骤中也会提示对数据库进行备份，在页面上出现升级成功提示表示升级完成。

#### 方式二：升级 Windows 一键安装包

如果使用的是 Windows 一键安装包安装的，则参照如下步骤进行升级操作：

1. 下载最新版本的源码包 [xxb.${version}.zip](${downloadUrl}${version}/xxb.${version}.zip)（**注意：此处不是下载 Windows 一键安装包**）；
2. 解压缩源码包，将解压后的所有源码文件合并到一键安装包的 `xampp/xxb` 目录内；
3. 访问 xxb 升级功能页面，例如 xxb 访问地址为 `http://192.168.0.100`，则升级功能页面地址为 `http://192.168.0.100/upgradexuanxuan.php`，按照页面提示进行升级操作，在此步骤中也会提示对数据库进行备份，在页面上出现升级成功提示表示升级完成。

?> 如果要升级一键安装包控制面板程序，则只需要安装新的一键安装包解压缩之后，将 `xampp/runner` 目录覆盖到原 `xampp/runner` 目录即可。

#### 方式三：升级 Linux 一键安装包

如果使用的是 Linux 一键安装包安装的，则参照如下步骤进行升级操作：

1. 下载最新版本的源码包 [xxb.${version}.zip](${downloadUrl}${version}/xxb.${version}.zip)（**注意：此处不是下载 Linux 一键安装包**）；
2. 解压缩源码包，将解压后的所有源码文件合并到一键安装包的 `/opt/zbox/app/xxb` 目录内，可以参考如下命令：
   ```
   $ sudo cp -rf xxb/* /opt/zbox/app/xxb/
   ```
3. 访问 xxb 升级功能页面，例如 xxb 访问地址为 `http://192.168.0.100`，则升级功能页面地址为 `http://192.168.0.100/upgradexuanxuan.php`，按照页面提示进行升级操作，在此步骤中也会提示对数据库进行备份，在页面上出现升级成功提示表示升级完成。

?> 如果要升级一键安装包控制面板程序，则只需要安装新的一键安装包解压缩之后，将 `xampp/runner` 目录覆盖到原 `xampp/runner` 目录即可。

### ** 升级然之协同 **

如果所使用的后端服务为然之协同，要进行升级操作参考官方升级文档 [https://www.ranzhi.org/book/ranzhi/ranzhiupgrade-7.html](https://www.ranzhi.org/book/ranzhi/ranzhiupgrade-7.html)。

<!-- tabs:end -->

## 升级 XXD 服务器

推荐将 XXD 服务器版本与官方最新版本保持一致，当 XXD 服务器发布了新的版本时，下载对应操作系统上的程序包，然后按照如下步骤进行升级：

1. 如果之前的 XXD 服务器已经在运行中，先停止运行 XXD 服务；
2. 将下载好的最新版本程序包解压缩后，删除程序包内内置的 `xxd/config/xxd.conf` 配置文件，然后覆盖到之前版本所在的目录中，然后重新启动 XXD 服务。

极少情况下，可能存在旧版本配置无法满足新版本要求，此时需要手动编辑新版本内置的配置文件，重新设置服务器配置信息。在修改配置文件之前请先备份旧的配置文件。
