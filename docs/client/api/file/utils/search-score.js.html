<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">utils/search-score.js | API</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-vue.css"><link rel="stylesheet" href="./inject/css/0-app.css"><link rel="stylesheet" href="./inject/css/0-esdoc.css"><script src="./inject/script/0-custom.js"></script><meta name="description" content="&#x4F01;&#x4E1A;&#x5373;&#x65F6;&#x901A;&#x8BAF;&#x5E73;&#x53F0;"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="API"><meta property="twitter:description" content="&#x4F01;&#x4E1A;&#x5373;&#x65F6;&#x901A;&#x8BAF;&#x5E73;&#x53F0;"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/easysoft/xuanxuan.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/utils/color.js~Color.html">Color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/utils/delay-action.js~DelayAction.html">DelayAction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/utils/status.js~Status.html">Status</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/utils/status.js~StatusKeeper.html">StatusKeeper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/utils/task-queue.js~TaskQueue.html">TaskQueue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createDate">createDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createPhpTimestramp">createPhpTimestramp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatDate">formatDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatSpan">formatSpan</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTimeBeforeDesc">getTimeBeforeDesc</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSameDay">isSameDay</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSameMonth">isSameMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSameYear">isSameYear</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isToday">isToday</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isYestoday">isYestoday</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-classes">classes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-escape">escape</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getSearchParam">getSearchParam</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isWebUrl">isWebUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-linkify">linkify</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rem">rem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-strip">strip</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cutImage">cutImage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getImageInfo">getImageInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-limittimepromise">limittimepromise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mdifileicon">mdifileicon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pinyin">pinyin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plain">plain</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-matchScore">matchScore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatKeyDecoration">formatKeyDecoration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getKeyDecoration">getKeyDecoration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isOnlyModifyKeys">isOnlyModifyKeys</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCodeFromString">getCodeFromString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-longShadow">longShadow</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-skinStyle">skinStyle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sortList">sortList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-clearStore">clearStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getStoreItem">getStoreItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getStoreLength">getStoreLength</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-removeStoreItem">removeStoreItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setStoreItem">setStoreItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-storeForEach">storeForEach</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-storeGetAll">storeGetAll</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatBytes">formatBytes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatString">formatString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ifEmptyStringThen">ifEmptyStringThen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isEmptyString">isEmptyString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isNotEmptyString">isNotEmptyString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timesequence">timesequence</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TIME_DAY">TIME_DAY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-renderer">renderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-fileIcons">fileIcons</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BYTE_UNITS">BYTE_UNITS</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">utils/search-score.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/** @module search-score */

/**
 * &#x6839;&#x636E;&#x6761;&#x4EF6;&#x63CF;&#x8FF0;&#x5BF9;&#x8C61;&#x83B7;&#x53D6;&#x7ED9;&#x5B9A;&#x5BF9;&#x8C61;&#x4E0E;&#x5173;&#x952E;&#x5B57;&#x7684;&#x5339;&#x914D;&#x5206;&#x503C;
 * @param {{name: !string, equal: number, include: boolean, array: boolean, prefix: string}} condition &#x6761;&#x4EF6;&#x63CF;&#x8FF0;
 * @param {string} key &#x5173;&#x952E;&#x5B57;
 * @param {Object} obj &#x8981;&#x8BA1;&#x7B97;&#x5206;&#x503C;&#x7684;&#x5BF9;&#x8C61;
 * @return {string}
 * @private
 */
const calcConditionScore = (condition, key, obj) =&gt; {
    let score = 0;
    let source = obj[condition.name];
    if (source === undefined || source === null) {
        return score;
    }
    if (typeof source === &apos;number&apos;) {
        source = `${source}`;
    }
    let searchKey = key;
    if (condition.prefix) {
        if (key.startsWith(condition.prefix) &amp;&amp; key.length &gt; condition.prefix.length) {
            const cIndex = key.lastIndexOf(&apos;(&apos;);
            if (key[key.length - 1] === &apos;)&apos; &amp;&amp; cIndex &gt; -1) {
                searchKey = key.substring(cIndex + 1, key.length - 1);
            } else {
                searchKey = key.substr(condition.prefix.length);
            }
        } else {
            return score;
        }
    }
    if (condition.array) {
        let arrayMatchCount = 0;
        source.forEach(item =&gt; {
            const itemSource = item.trim().toLowerCase();
            if (condition.equal &amp;&amp; itemSource === searchKey) {
                score += condition.equal;
                arrayMatchCount += 1;
            } else if (condition.include &amp;&amp; itemSource.includes(searchKey)) {
                score += condition.include;
                arrayMatchCount += 1;
            }
        });
        if (arrayMatchCount &lt; source.length) {
            score /= 2;
        }
    } else {
        const sourceValue = source.trim().toLowerCase();
        if (condition.equal &amp;&amp; sourceValue === searchKey) {
            score += condition.equal;
        } else if (condition.include &amp;&amp; sourceValue.includes(searchKey)) {
            score += condition.include;
        }
    }
    return score;
};

/**
 * &#x6839;&#x636E;&#x6761;&#x4EF6;&#x6743;&#x503C;&#x8868;&#x83B7;&#x53D6;&#x7ED9;&#x5B9A;&#x5BF9;&#x8C61;&#x4E0E;&#x5173;&#x952E;&#x5B57;&#x7684;&#x5339;&#x914D;&#x7A0B;&#x5EA6;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5206;&#x503C;&#x4F5C;&#x4E3A;&#x6BD4;&#x8F83;&#xFF0C;&#x5206;&#x503C;&#x8D8A;&#x5927;&#x8868;&#x793A;&#x8D8A;&#x5339;&#x914D;
 *
 * @example &lt;caption&gt;&#x6761;&#x4EF6;&#x63CF;&#x8FF0;&#x5BF9;&#x8C61;&#x4F8B;&#x5B50;&lt;/caption&gt;
 * const conditions = [
 *     {name: &apos;name&apos;, equal: 100, include: 50},
 *     {name: &apos;displayName&apos;, equal: 100, include: 50},
 *     {name: &apos;description&apos;, include: 25},
 *     {name: &apos;keywords&apos;, equal: 50, include: 10, array: true},
 *     {name: &apos;type&apos;, equal: 100, prefix: &apos;:&apos;},
 *     {name: &apos;author&apos;, equal: 100, prefix: &apos;@&apos;},
 *     {name: &apos;publisher&apos;, equal: 100, prefix: &apos;@&apos;},
 *     {name: &apos;homepage&apos;, include: 25},
 * ];
 *
 * @param {Array} conditions &#x6761;&#x4EF6;&#x63CF;&#x8FF0;&#x5BF9;&#x8C61;
 * @param {Array&lt;String&gt;} keys &#x641C;&#x7D22;&#x5173;&#x952E;&#x8BCD;&#x7EC4;
 * @function
 * @return {number} &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5206;&#x503C;&#x4F5C;&#x4E3A;&#x6BD4;&#x8F83;&#xFF0C;&#x5206;&#x503C;&#x8D8A;&#x5927;&#x8868;&#x793A;&#x8D8A;&#x5339;&#x914D;
 */
export const matchScore = (conditions, obj, keys) =&gt; {
    if (!Array.isArray(keys)) {
        keys = [keys];
    }
    if (!Array.isArray(conditions)) {
        conditions = [conditions];
    }
    let score = 0;
    let matchCount = 0;

    keys.forEach(key =&gt; {
        if (key === undefined || key === null || !key.length) {
            return;
        }
        conditions.forEach(condition =&gt; {
            const conditionScore = calcConditionScore(condition, key, obj);
            if (conditionScore) {
                matchCount += 1;
                score += conditionScore;
            }
        });
    });

    if (matchCount !== keys.length) {
        score /= 2;
    }
    return score;
};

export default {matchScore};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
